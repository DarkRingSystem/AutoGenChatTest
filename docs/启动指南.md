# 🚀 项目启动和重启指南

## 📋 目录
- [快速启动](#快速启动)
- [详细步骤](#详细步骤)
- [重启项目](#重启项目)
- [停止项目](#停止项目)
- [常见问题](#常见问题)
- [进程管理](#进程管理)

---

## ⚡ 快速启动

### 方法一：使用启动脚本（推荐）

```bash
# Unix/Linux/Mac
./start.sh

# Windows
start.bat
```

### 方法二：手动启动

```bash
# 1. 启动后端（终端 1）
cd backend
python3 main.py

# 2. 启动前端（终端 2 - 新开一个终端）
cd frontend
npm run dev
```

---

## 📝 详细步骤

### 第一次启动

#### 1️⃣ 安装后端依赖

```bash
cd backend
pip3 install -r requirements.txt
```

**预期输出：**
```
Successfully installed autogen-agentchat-0.7.5 autogen-core-0.7.5 ...
```

#### 2️⃣ 配置环境变量

编辑 `backend/.env` 文件：

```env
# DeepSeek 配置
API_KEY=sk-你的密钥
MODEL_NAME=deepseek-chat
BASE_URL=https://api.deepseek.com

# 服务器配置
HOST=0.0.0.0
PORT=8000
```

#### 3️⃣ 安装前端依赖

```bash
cd frontend
npm install
```

**预期输出：**
```
added 471 packages in 23s
```

#### 4️⃣ 启动后端

```bash
cd backend
python3 main.py
```

**成功标志：**
```
🚀 正在初始化 AI 模型...
   模型: deepseek-chat
   API: https://api.deepseek.com
✅ AI 智能体初始化成功！
INFO:     Uvicorn running on http://0.0.0.0:8000
INFO:     Application startup complete.
```

#### 5️⃣ 启动前端（新终端）

```bash
cd frontend
npm run dev
```

**成功标志：**
```
VITE v5.4.20  ready in 123 ms

➜  Local:   http://localhost:3000/
➜  Network: use --host to expose
```

#### 6️⃣ 访问应用

打开浏览器访问：
- **前端应用**: http://localhost:3000
- **后端 API**: http://localhost:8000
- **API 文档**: http://localhost:8000/docs

---

## 🔄 重启项目

### 方法一：使用快捷键（推荐）

#### 停止服务
在运行的终端中按：
```
Ctrl + C
```

#### 重新启动
```bash
# 后端
cd backend && python3 main.py

# 前端
cd frontend && npm run dev
```

### 方法二：使用进程管理

#### 查看运行的进程
```bash
# Mac/Linux
ps aux | grep "python3 main.py"
ps aux | grep "vite"

# 或使用 lsof 查看端口占用
lsof -i :8000  # 后端
lsof -i :3000  # 前端
```

#### 杀死进程
```bash
# 方法 1: 使用 PID
kill -9 <PID>

# 方法 2: 杀死所有相关进程
pkill -f "python3 main.py"
pkill -f "vite"

# 方法 3: 杀死占用端口的进程
lsof -ti:8000 | xargs kill -9
lsof -ti:3000 | xargs kill -9
```

#### 重新启动
```bash
cd backend && python3 main.py &
cd frontend && npm run dev &
```

### 方法三：使用 tmux/screen（高级）

#### 使用 tmux
```bash
# 创建会话
tmux new -s autogen

# 分割窗口
Ctrl+B 然后按 %

# 左侧运行后端
cd backend && python3 main.py

# 切换到右侧（Ctrl+B 然后按 →）
cd frontend && npm run dev

# 分离会话（Ctrl+B 然后按 D）
# 重新连接：tmux attach -t autogen
```

---

## 🛑 停止项目

### 方法一：优雅停止

在每个运行的终端中按：
```
Ctrl + C
```

等待服务正常关闭。

### 方法二：强制停止

```bash
# 停止后端
lsof -ti:8000 | xargs kill -9

# 停止前端
lsof -ti:3000 | xargs kill -9
```

### 方法三：停止所有相关进程

```bash
# 创建停止脚本 stop.sh
cat > stop.sh << 'EOF'
#!/bin/bash
echo "🛑 停止后端服务..."
lsof -ti:8000 | xargs kill -9 2>/dev/null
echo "🛑 停止前端服务..."
lsof -ti:3000 | xargs kill -9 2>/dev/null
echo "✅ 所有服务已停止"
EOF

chmod +x stop.sh
./stop.sh
```

---

## ❓ 常见问题

### 1. 端口已被占用

**错误信息：**
```
Error: listen EADDRINUSE: address already in use :::8000
```

**解决方法：**
```bash
# 查找占用端口的进程
lsof -i :8000

# 杀死进程
kill -9 <PID>

# 或直接
lsof -ti:8000 | xargs kill -9
```

### 2. Python 命令不存在

**错误信息：**
```
command not found: python
```

**解决方法：**
```bash
# 使用 python3
python3 main.py

# 或创建别名
alias python=python3
```

### 3. 依赖安装失败

**错误信息：**
```
ERROR: Could not find a version that satisfies the requirement
```

**解决方法：**
```bash
# 升级 pip
pip3 install --upgrade pip

# 清除缓存
pip3 cache purge

# 重新安装
pip3 install -r requirements.txt
```

### 4. 前端启动失败

**错误信息：**
```
sh: vite: command not found
```

**解决方法：**
```bash
# 删除 node_modules
rm -rf node_modules package-lock.json

# 重新安装
npm install

# 启动
npm run dev
```

### 5. API Key 未配置

**错误信息：**
```
ValueError: API_KEY 环境变量未设置
```

**解决方法：**
```bash
# 检查 .env 文件
cat backend/.env

# 确保包含
API_KEY=sk-你的密钥
MODEL_NAME=deepseek-chat
BASE_URL=https://api.deepseek.com
```

---

## 🔧 进程管理

### 查看运行状态

```bash
# 检查后端
curl http://localhost:8000/health

# 检查前端
curl http://localhost:3000
```

### 查看日志

```bash
# 后端日志（如果使用后台运行）
tail -f backend/logs/app.log

# 前端日志
# 直接在终端查看
```

### 后台运行

```bash
# 后端后台运行
cd backend
nohup python3 main.py > logs/backend.log 2>&1 &

# 前端后台运行
cd frontend
nohup npm run dev > logs/frontend.log 2>&1 &

# 查看进程
ps aux | grep "python3 main.py"
ps aux | grep "vite"
```

---

## 📊 启动检查清单

启动前检查：
- [ ] Python 3.11+ 已安装
- [ ] Node.js 18+ 已安装
- [ ] 后端依赖已安装
- [ ] 前端依赖已安装
- [ ] .env 文件已配置
- [ ] API Key 有效
- [ ] 端口 8000 和 3000 未被占用

启动后验证：
- [ ] 后端显示 "✅ AI 智能体初始化成功！"
- [ ] 前端显示 "VITE ready"
- [ ] http://localhost:8000/health 返回 OK
- [ ] http://localhost:3000 可以访问
- [ ] 可以发送消息并收到回复

---

## 🎯 快速命令参考

```bash
# 启动
cd backend && python3 main.py          # 后端
cd frontend && npm run dev             # 前端

# 停止
Ctrl + C                               # 优雅停止
lsof -ti:8000 | xargs kill -9         # 强制停止后端
lsof -ti:3000 | xargs kill -9         # 强制停止前端

# 重启
Ctrl + C && python3 main.py           # 后端重启
Ctrl + C && npm run dev               # 前端重启

# 检查
curl http://localhost:8000/health     # 后端健康检查
curl http://localhost:3000            # 前端检查
lsof -i :8000                         # 查看后端进程
lsof -i :3000                         # 查看前端进程
```

---

**提示**: 建议使用两个终端窗口，一个运行后端，一个运行前端，这样可以同时查看两边的日志输出。

