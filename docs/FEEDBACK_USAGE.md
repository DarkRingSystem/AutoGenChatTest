# æ™ºèƒ½ä½“åé¦ˆåŠŸèƒ½ä½¿ç”¨æŒ‡å—

## åŠŸèƒ½æ¦‚è¿°

æ™ºèƒ½ä½“åé¦ˆåŠŸèƒ½å…è®¸ç”¨æˆ·åœ¨ `TestCase_Reviewer` æˆ– `TestCase_Optimizer` å®Œæˆå·¥ä½œåï¼Œæä¾›åé¦ˆå¹¶æŒ‡å®šç‰¹å®šæ™ºèƒ½ä½“ç»§ç»­å¯¹è¯ï¼Œæˆ–è€…ç›´æ¥åŒæ„ç»“æŸå¯¹è¯ã€‚

## ä½¿ç”¨åœºæ™¯

### åœºæ™¯ 1ï¼šæ­£å¸¸å·¥ä½œæµç¨‹

1. **ç”¨æˆ·å‘é€éœ€æ±‚**
   ```
   ç”¨æˆ·: "ç”Ÿæˆç™»å½•åŠŸèƒ½çš„æµ‹è¯•ç”¨ä¾‹"
   ```

2. **æ™ºèƒ½ä½“è‡ªåŠ¨åä½œ**
   ```
   Generator â†’ ç”Ÿæˆæµ‹è¯•ç”¨ä¾‹
   Reviewer â†’ è¯„å®¡æµ‹è¯•ç”¨ä¾‹
   [ç­‰å¾…ç”¨æˆ·åé¦ˆ]
   ```

3. **å‰ç«¯æ˜¾ç¤ºåé¦ˆå¯¹è¯æ¡†**
   - æ˜¾ç¤ºæç¤ºä¿¡æ¯
   - æ˜¾ç¤ºå¯ç”¨æ™ºèƒ½ä½“åˆ—è¡¨
   - æ˜¾ç¤º"åŒæ„"æŒ‰é’®

4. **ç”¨æˆ·é€‰æ‹©æ“ä½œ**
   - **é€‰é¡¹ A**: ç‚¹å‡»"åŒæ„"æŒ‰é’® â†’ ç»“æŸå¯¹è¯
   - **é€‰é¡¹ B**: è¾“å…¥åé¦ˆå†…å®¹ â†’ ç»§ç»­å¯¹è¯

### åœºæ™¯ 2ï¼šæä¾›åé¦ˆå¹¶ç»§ç»­

ç”¨æˆ·è¾“å…¥åé¦ˆï¼š
```
"è¯·æ·»åŠ æ›´å¤šè¾¹ç•Œæµ‹è¯•ç”¨ä¾‹"
```

ç³»ç»Ÿè¡Œä¸ºï¼š
- Generator ç»§ç»­å·¥ä½œï¼ˆé»˜è®¤è½®è¯¢é¡ºåºï¼‰
- ç”Ÿæˆæ–°çš„æµ‹è¯•ç”¨ä¾‹
- Reviewer å†æ¬¡è¯„å®¡
- [å†æ¬¡ç­‰å¾…ç”¨æˆ·åé¦ˆ]

### åœºæ™¯ 3ï¼šæŒ‡å®šæ™ºèƒ½ä½“å›ç­”

ç”¨æˆ·è¾“å…¥åé¦ˆå¹¶ @ æåŠæ™ºèƒ½ä½“ï¼š
```
"@TestCase_Optimizer è¯·ä¼˜åŒ–æ€§èƒ½æµ‹è¯•ç”¨ä¾‹"
```

ç³»ç»Ÿè¡Œä¸ºï¼š
- Optimizer æ¥æ”¶åé¦ˆå¹¶å·¥ä½œ
- ä¼˜åŒ–æµ‹è¯•ç”¨ä¾‹
- [ç­‰å¾…ç”¨æˆ·åé¦ˆ]

### åœºæ™¯ 4ï¼šç›´æ¥åŒæ„

ç”¨æˆ·ç‚¹å‡»"åŒæ„"æŒ‰é’®æˆ–è¾“å…¥"åŒæ„"ï¼š
```
"åŒæ„"
```

ç³»ç»Ÿè¡Œä¸ºï¼š
- ç»“æŸå¯¹è¯
- æ¸…ç†å›¢é˜Ÿå®ä¾‹
- æ˜¾ç¤º"ç”¨æˆ·å·²åŒæ„ï¼Œå¯¹è¯ç»“æŸ"

## å‰ç«¯ç•Œé¢

### åé¦ˆå¯¹è¯æ¡†

å½“æ™ºèƒ½ä½“å®Œæˆå·¥ä½œåï¼Œä¼šåœ¨æ¶ˆæ¯ä¸‹æ–¹æ˜¾ç¤ºåé¦ˆå¯¹è¯æ¡†ï¼š

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ ğŸ’¬ æµ‹è¯•ç”¨ä¾‹è¯„å®¡å‘˜ å·²å®Œæˆï¼Œè¯·æä¾›åé¦ˆ      â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚ â€¢ ç›´æ¥ç‚¹å‡»"åŒæ„"æˆ–ç•™ç©ºå‘é€ï¼Œå°†ç»“æŸæ™ºèƒ½ä½“åä½œ â”‚
â”‚ â€¢ è¾“å…¥åé¦ˆå†…å®¹ï¼Œå¯ä»¥ä½¿ç”¨ @æ™ºèƒ½ä½“åç§° æŒ‡å®šå›å¤çš„æ™ºèƒ½ä½“ â”‚
â”‚ â€¢ å¯ç”¨æ™ºèƒ½ä½“ï¼š@TestCase_Generator, @TestCase_Reviewer, @TestCase_Optimizer â”‚
â”‚                                         â”‚
â”‚                        [âœ… åŒæ„]         â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

### @ æ™ºèƒ½ä½“è¯­æ³•

æ”¯æŒä»¥ä¸‹æ™ºèƒ½ä½“åç§°ï¼š
- `@TestCase_Generator` - æµ‹è¯•ç”¨ä¾‹ç”Ÿæˆå™¨
- `@TestCase_Reviewer` - æµ‹è¯•ç”¨ä¾‹è¯„å®¡å‘˜
- `@TestCase_Optimizer` - æµ‹è¯•ç”¨ä¾‹ä¼˜åŒ–å™¨

ç¤ºä¾‹ï¼š
```
@TestCase_Generator è¯·æ·»åŠ å¼‚å¸¸å¤„ç†çš„æµ‹è¯•ç”¨ä¾‹
@TestCase_Reviewer è¯·é‡æ–°è¯„å®¡è¾¹ç•Œæ¡ä»¶
@TestCase_Optimizer è¯·ä¼˜åŒ–æµ‹è¯•ç”¨ä¾‹çš„å¯è¯»æ€§
```

## API ä½¿ç”¨

### 1. æ–°å¯¹è¯

**è¯·æ±‚**:
```bash
POST /api/team-chat/stream
Content-Type: application/json

{
  "message": "ç”Ÿæˆç™»å½•åŠŸèƒ½çš„æµ‹è¯•ç”¨ä¾‹"
}
```

**å“åº”**:
```
data: {"type":"agent_start","agent_name":"TestCase_Generator",...}
data: {"type":"agent_message","content":"...",...}
data: {"type":"agent_done","agent_name":"TestCase_Generator",...}
data: {"type":"agent_start","agent_name":"TestCase_Reviewer",...}
data: {"type":"agent_message","content":"...",...}
data: {"type":"agent_done","agent_name":"TestCase_Reviewer",...}
data: {"type":"feedback_request","content":"è¯·æä¾›åé¦ˆ","available_agents":[...],...}
data: [DONE]
```

**å“åº”å¤´**:
```
X-Conversation-ID: team_session_abc123
```

### 2. æä¾›åé¦ˆ

**è¯·æ±‚**:
```bash
POST /api/team-chat/stream
Content-Type: application/json

{
  "message": "@TestCase_Generator è¯·æ·»åŠ è¾¹ç•Œæµ‹è¯•ç”¨ä¾‹",
  "conversation_id": "team_session_abc123",
  "is_feedback": true
}
```

**å“åº”**:
```
data: {"type":"agent_start","agent_name":"TestCase_Generator",...}
data: {"type":"agent_message","content":"...",...}
...
```

### 3. åŒæ„å¹¶ç»“æŸ

**è¯·æ±‚**:
```bash
POST /api/team-chat/stream
Content-Type: application/json

{
  "message": "åŒæ„",
  "conversation_id": "team_session_abc123",
  "is_feedback": true
}
```

**å“åº”**:
```
data: {"type":"done","content":"ç”¨æˆ·å·²åŒæ„ï¼Œå¯¹è¯ç»“æŸ"}
data: [DONE]
```

## æŠ€æœ¯å®ç°

### åç«¯

1. **ä¼šè¯ç®¡ç†**: ä½¿ç”¨ `TeamSessionService` ç®¡ç†å¯¹è¯çŠ¶æ€
2. **å›¢é˜Ÿç¼“å­˜**: ä½¿ç”¨å…¨å±€å­—å…¸ç¼“å­˜å›¢é˜Ÿå®ä¾‹
3. **ç»ˆæ­¢æ¡ä»¶**: åœ¨ Reviewer/Optimizer å®Œæˆååœæ­¢
4. **åé¦ˆæ£€æµ‹**: æ£€æµ‹ `is_feedback` æ ‡å¿—å¹¶æ¢å¤å›¢é˜Ÿ

### å‰ç«¯

1. **åé¦ˆæ£€æµ‹**: æ£€æµ‹æ¶ˆæ¯ä¸­çš„ `feedbackRequest` å­—æ®µ
2. **ä¼šè¯ä¿æŒ**: ä¿å­˜ `conversationId` å¹¶åœ¨åé¦ˆæ—¶å‘é€
3. **@ è§£æ**: ä½¿ç”¨æ­£åˆ™è¡¨è¾¾å¼æå–ç›®æ ‡æ™ºèƒ½ä½“
4. **UI äº¤äº’**: æ˜¾ç¤ºåé¦ˆå¯¹è¯æ¡†å’Œ"åŒæ„"æŒ‰é’®

## æµ‹è¯•

### ä½¿ç”¨æµ‹è¯•è„šæœ¬

```bash
./test_feedback_flow.sh
```

### æ‰‹åŠ¨æµ‹è¯•

1. å¯åŠ¨æœåŠ¡ï¼š
   ```bash
   ./start.sh
   ```

2. æ‰“å¼€å‰ç«¯ï¼š
   ```bash
   cd frontend
   npm run dev
   ```

3. æµ‹è¯•æµç¨‹ï¼š
   - åˆ‡æ¢åˆ°"æ™ºèƒ½ä½“å›¢é˜Ÿ"æ¨¡å¼
   - å‘é€æµ‹è¯•éœ€æ±‚
   - ç­‰å¾…åé¦ˆå¯¹è¯æ¡†å‡ºç°
   - å°è¯•ä¸åŒçš„åé¦ˆæ–¹å¼

## æ³¨æ„äº‹é¡¹

1. **ä¼šè¯è¶…æ—¶**: å›¢é˜Ÿå®ä¾‹ç¼“å­˜åœ¨å†…å­˜ä¸­ï¼Œé•¿æ—¶é—´ä¸æ´»åŠ¨å¯èƒ½è¢«æ¸…ç†
2. **å¹¶å‘é™åˆ¶**: å½“å‰å®ç°ä½¿ç”¨å…¨å±€å­—å…¸ï¼Œä¸æ”¯æŒåˆ†å¸ƒå¼éƒ¨ç½²
3. **é”™è¯¯æ¢å¤**: å¦‚æœå›¢é˜Ÿå®ä¾‹ä¸¢å¤±ï¼Œéœ€è¦é‡æ–°å¼€å§‹å¯¹è¯
4. **@ è¯­æ³•**: å¿…é¡»ä½¿ç”¨å®Œæ•´çš„æ™ºèƒ½ä½“åç§°ï¼Œå¦‚ `@TestCase_Generator`

## å¸¸è§é—®é¢˜

### Q: ä¸ºä»€ä¹ˆæˆ‘çš„åé¦ˆæ²¡æœ‰ç”Ÿæ•ˆï¼Ÿ

A: æ£€æŸ¥ä»¥ä¸‹å‡ ç‚¹ï¼š
- æ˜¯å¦åœ¨åé¦ˆå¯¹è¯æ¡†å‡ºç°åå‘é€çš„æ¶ˆæ¯
- `conversation_id` æ˜¯å¦æ­£ç¡®
- æ˜¯å¦è®¾ç½®äº† `is_feedback: true`

### Q: å¦‚ä½•æŒ‡å®šç‰¹å®šæ™ºèƒ½ä½“å›ç­”ï¼Ÿ

A: åœ¨æ¶ˆæ¯ä¸­ä½¿ç”¨ @ è¯­æ³•ï¼Œä¾‹å¦‚ï¼š
```
@TestCase_Generator è¯·æ·»åŠ æ›´å¤šæµ‹è¯•ç”¨ä¾‹
```

### Q: ç‚¹å‡»"åŒæ„"åè¿˜èƒ½ç»§ç»­å¯¹è¯å—ï¼Ÿ

A: ä¸èƒ½ã€‚ç‚¹å‡»"åŒæ„"ä¼šç»“æŸå¯¹è¯å¹¶æ¸…ç†å›¢é˜Ÿå®ä¾‹ã€‚å¦‚æœéœ€è¦ç»§ç»­ï¼Œè¯·é‡æ–°å¼€å§‹å¯¹è¯ã€‚

### Q: æ”¯æŒå¤šè½®åé¦ˆå—ï¼Ÿ

A: æ”¯æŒã€‚æ¯æ¬¡æ™ºèƒ½ä½“å®Œæˆåéƒ½ä¼šç­‰å¾…åé¦ˆï¼Œå¯ä»¥è¿›è¡Œå¤šè½®åé¦ˆç›´åˆ°ç”¨æˆ·åŒæ„ã€‚

## æœªæ¥æ”¹è¿›

1. **ä¼šè¯æŒä¹…åŒ–**: ä½¿ç”¨ Redis å­˜å‚¨ä¼šè¯çŠ¶æ€
2. **è¶…æ—¶æ¸…ç†**: è‡ªåŠ¨æ¸…ç†è¿‡æœŸçš„å›¢é˜Ÿå®ä¾‹
3. **æ™ºèƒ½ä½“é€‰æ‹©å™¨**: æä¾›ä¸‹æ‹‰èœå•é€‰æ‹©æ™ºèƒ½ä½“
4. **åé¦ˆå†å²**: æ˜¾ç¤ºä¹‹å‰çš„åé¦ˆè®°å½•
5. **å¿«æ·å›å¤**: æä¾›å¸¸ç”¨åé¦ˆæ¨¡æ¿

