# ğŸ‰ æç¤ºè¯ç®¡ç†ç³»ç»Ÿå®ç°å®Œæˆï¼

## æ¦‚è¿°

æˆåŠŸå®ç°äº†ä¸€ä¸ªé›†ä¸­åŒ–çš„æç¤ºè¯ç®¡ç†ç³»ç»Ÿï¼Œå°†æ‰€æœ‰æ™ºèƒ½ä½“çš„ç³»ç»Ÿæç¤ºè¯ä»ä»£ç ä¸­åˆ†ç¦»å‡ºæ¥ï¼Œç»Ÿä¸€ç®¡ç†åœ¨ `backend/prompts/` ç›®å½•ä¸­ã€‚

---

## âœ… å®Œæˆå†…å®¹

### 1. **ç›®å½•ç»“æ„**

```
backend/prompts/
â”œâ”€â”€ README.md                      # è¯¦ç»†ä½¿ç”¨æ–‡æ¡£
â”œâ”€â”€ prompt_loader.py               # æç¤ºè¯åŠ è½½å™¨
â”œâ”€â”€ assistant.txt                  # é€šç”¨åŠ©æ‰‹æç¤ºè¯
â”œâ”€â”€ test_case_generator.txt        # æµ‹è¯•ç”¨ä¾‹ç”Ÿæˆä¸“å®¶æç¤ºè¯
â”œâ”€â”€ test_case_reviewer.txt         # æµ‹è¯•ç”¨ä¾‹è¯„å®¡ä¸“å®¶æç¤ºè¯
â””â”€â”€ test_case_optimizer.txt        # æµ‹è¯•ç”¨ä¾‹ä¼˜åŒ–ä¸“å®¶æç¤ºè¯
```

### 2. **æ ¸å¿ƒç»„ä»¶**

#### A. æç¤ºè¯åŠ è½½å™¨ (`prompt_loader.py`)
- âœ… `PromptLoader` ç±»ï¼šè´Ÿè´£åŠ è½½å’Œç®¡ç†æç¤ºè¯
- âœ… æ”¯æŒç¼“å­˜æœºåˆ¶ï¼Œæé«˜æ€§èƒ½
- âœ… æ”¯æŒçƒ­é‡è½½ï¼Œæ–¹ä¾¿å¼€å‘è°ƒè¯•
- âœ… æä¾›ä¾¿æ·å‡½æ•° `load_prompt()`
- âœ… å®šä¹‰æç¤ºè¯åç§°å¸¸é‡ `PromptNames`

#### B. æç¤ºè¯æ–‡ä»¶
- âœ… `assistant.txt`ï¼šé€šç”¨ AI åŠ©æ‰‹æç¤ºè¯
- âœ… `test_case_generator.txt`ï¼šæµ‹è¯•ç”¨ä¾‹ç”Ÿæˆä¸“å®¶ï¼ˆè¯¦ç»†ç‰ˆï¼‰
- âœ… `test_case_reviewer.txt`ï¼šæµ‹è¯•ç”¨ä¾‹è¯„å®¡ä¸“å®¶ï¼ˆè¯¦ç»†ç‰ˆï¼‰
- âœ… `test_case_optimizer.txt`ï¼šæµ‹è¯•ç”¨ä¾‹ä¼˜åŒ–ä¸“å®¶ï¼ˆè¯¦ç»†ç‰ˆï¼‰

#### C. ä»£ç é›†æˆ
- âœ… ä¿®æ”¹ `backend/services/ai_service.py`
- âœ… å¯¼å…¥æç¤ºè¯åŠ è½½å™¨
- âœ… ä½¿ç”¨ `load_prompt()` åŠ è½½æç¤ºè¯
- âœ… æ›¿æ¢æ‰€æœ‰ç¡¬ç¼–ç çš„æç¤ºè¯

---

## ğŸ¯ è®¾è®¡ä¼˜åŠ¿

### 1. **é›†ä¸­ç®¡ç†**
- æ‰€æœ‰æç¤ºè¯é›†ä¸­åœ¨ä¸€ä¸ªç›®å½•
- ä¾¿äºæŸ¥æ‰¾å’Œä¿®æ”¹
- é¿å…æç¤ºè¯æ•£è½åœ¨ä»£ç å„å¤„

### 2. **æ˜“äºç»´æŠ¤**
- ä¿®æ”¹æç¤ºè¯ä¸éœ€è¦æ”¹åŠ¨ä»£ç 
- æ”¯æŒç‰ˆæœ¬æ§åˆ¶ï¼ˆGitï¼‰
- å¯ä»¥å¿«é€Ÿè¿­ä»£ä¼˜åŒ–

### 3. **å¯è¯»æ€§å¼º**
- ä½¿ç”¨çº¯æ–‡æœ¬æ–‡ä»¶ï¼Œæ˜“äºé˜…è¯»
- æ”¯æŒå¤šè¡Œæ ¼å¼ï¼Œä¾¿äºç»„ç»‡å¤æ‚æç¤ºè¯
- å¯ä»¥æ·»åŠ  Markdown æ ¼å¼çš„æ³¨é‡Šå’Œè¯´æ˜

### 4. **çµæ´»æ€§é«˜**
- æ”¯æŒçƒ­é‡è½½ï¼ˆå¼€å‘æ¨¡å¼ï¼‰
- æ”¯æŒç¼“å­˜ï¼ˆç”Ÿäº§æ¨¡å¼ï¼‰
- å¯ä»¥åŠ¨æ€åˆ‡æ¢ä¸åŒçš„æç¤ºè¯

### 5. **ç±»å‹å®‰å…¨**
- ä½¿ç”¨ `PromptNames` å¸¸é‡é¿å…æ‹¼å†™é”™è¯¯
- IDE è‡ªåŠ¨è¡¥å…¨æ”¯æŒ
- ç¼–è¯‘æ—¶æ£€æŸ¥

---

## ğŸ“ ä½¿ç”¨æ–¹æ³•

### 1. **åœ¨ä»£ç ä¸­åŠ è½½æç¤ºè¯**

```python
from prompts.prompt_loader import load_prompt, PromptNames

# æ–¹å¼ 1: ä½¿ç”¨ä¾¿æ·å‡½æ•° + å¸¸é‡ï¼ˆæ¨èï¼‰
system_message = load_prompt(PromptNames.TEST_CASE_GENERATOR)

# æ–¹å¼ 2: ä½¿ç”¨å­—ç¬¦ä¸²
system_message = load_prompt("test_case_generator")

# æ–¹å¼ 3: ä½¿ç”¨åŠ è½½å™¨å®ä¾‹
from prompts.prompt_loader import get_prompt_loader

loader = get_prompt_loader()
system_message = loader.load("test_case_generator")
```

### 2. **åœ¨æ™ºèƒ½ä½“ä¸­ä½¿ç”¨**

```python
from autogen_agentchat.agents import AssistantAgent
from prompts.prompt_loader import load_prompt, PromptNames

# åˆ›å»ºæ™ºèƒ½ä½“
agent = AssistantAgent(
    name="TestCase_Generator",
    model_client=model_client,
    system_message=load_prompt(PromptNames.TEST_CASE_GENERATOR),
    model_client_stream=True,
)
```

### 3. **ä¿®æ”¹æç¤ºè¯**

```bash
# 1. ç¼–è¾‘æç¤ºè¯æ–‡ä»¶
vim backend/prompts/test_case_generator.txt

# 2. ä¿å­˜æ–‡ä»¶

# 3. é‡å¯æœåŠ¡ï¼ˆæˆ–ä½¿ç”¨çƒ­é‡è½½ï¼‰
```

### 4. **å¼€å‘æ¨¡å¼ï¼šçƒ­é‡è½½**

```python
from prompts.prompt_loader import get_prompt_loader

loader = get_prompt_loader()

# é‡æ–°åŠ è½½å•ä¸ªæç¤ºè¯
system_message = loader.reload("test_case_generator")

# æ¸…é™¤æ‰€æœ‰ç¼“å­˜
loader.clear_cache()
```

---

## ğŸ“‹ æç¤ºè¯åˆ—è¡¨

| æ–‡ä»¶å | å¸¸é‡å | æ™ºèƒ½ä½“ | ç”¨é€” |
|--------|--------|--------|------|
| `assistant.txt` | `PromptNames.ASSISTANT` | Assistant | é€šç”¨ AI åŠ©æ‰‹ |
| `test_case_generator.txt` | `PromptNames.TEST_CASE_GENERATOR` | TestCase_Generator | ç”Ÿæˆæµ‹è¯•ç”¨ä¾‹ |
| `test_case_reviewer.txt` | `PromptNames.TEST_CASE_REVIEWER` | TestCase_Reviewer | è¯„å®¡æµ‹è¯•ç”¨ä¾‹ |
| `test_case_optimizer.txt` | `PromptNames.TEST_CASE_OPTIMIZER` | TestCase_Optimizer | ä¼˜åŒ–æµ‹è¯•ç”¨ä¾‹ |

---

## ğŸ”§ æ ¸å¿ƒåŠŸèƒ½

### 1. **PromptLoader ç±»**

```python
class PromptLoader:
    def __init__(self, prompts_dir: Optional[str] = None)
    def load(self, prompt_name: str, use_cache: bool = True) -> str
    def reload(self, prompt_name: str) -> str
    def clear_cache(self) -> None
    def list_prompts(self) -> list[str]
    def get_prompt_path(self, prompt_name: str) -> Path
```

### 2. **ä¾¿æ·å‡½æ•°**

```python
# è·å–å…¨å±€åŠ è½½å™¨å®ä¾‹
loader = get_prompt_loader()

# åŠ è½½æç¤ºè¯
prompt = load_prompt("test_case_generator")
```

### 3. **æç¤ºè¯åç§°å¸¸é‡**

```python
class PromptNames:
    ASSISTANT = "assistant"
    TEST_CASE_GENERATOR = "test_case_generator"
    TEST_CASE_REVIEWER = "test_case_reviewer"
    TEST_CASE_OPTIMIZER = "test_case_optimizer"
```

---

## ğŸ“Š æç¤ºè¯å†…å®¹å¯¹æ¯”

### ä¿®æ”¹å‰ï¼ˆç¡¬ç¼–ç åœ¨ä»£ç ä¸­ï¼‰

```python
system_message = "ä½ æ˜¯ä¸€ä¸ªæµ‹è¯•ç”¨ä¾‹ç”Ÿæˆä¸“å®¶ï¼Œè´Ÿè´£æ ¹æ®éœ€æ±‚ç”Ÿæˆå…¨é¢ã€è¯¦ç»†çš„æµ‹è¯•ç”¨ä¾‹ã€‚è¯·ç¡®ä¿æµ‹è¯•ç”¨ä¾‹è¦†ç›–æ­£å¸¸åœºæ™¯ã€è¾¹ç•Œæ¡ä»¶å’Œå¼‚å¸¸æƒ…å†µã€‚"
```

**é—®é¢˜**ï¼š
- âŒ æç¤ºè¯å¤ªç®€å•
- âŒ ä¿®æ”¹éœ€è¦æ”¹ä»£ç 
- âŒ éš¾ä»¥ç»´æŠ¤å’Œä¼˜åŒ–
- âŒ æ²¡æœ‰ç‰ˆæœ¬æ§åˆ¶

### ä¿®æ”¹åï¼ˆä»æ–‡ä»¶åŠ è½½ï¼‰

```python
system_message = load_prompt(PromptNames.TEST_CASE_GENERATOR)
```

**æ–‡ä»¶å†…å®¹** (`test_case_generator.txt`)ï¼š
```
ä½ æ˜¯ä¸€ä¸ªæµ‹è¯•ç”¨ä¾‹ç”Ÿæˆä¸“å®¶ï¼Œè´Ÿè´£æ ¹æ®éœ€æ±‚ç”Ÿæˆå…¨é¢ã€è¯¦ç»†çš„æµ‹è¯•ç”¨ä¾‹ã€‚

## èŒè´£
- åˆ†æåŠŸèƒ½éœ€æ±‚ï¼Œè¯†åˆ«æµ‹è¯•åœºæ™¯
- ç”Ÿæˆè¦†ç›–å…¨é¢çš„æµ‹è¯•ç”¨ä¾‹
- ç¡®ä¿æµ‹è¯•ç”¨ä¾‹åŒ…å«æ­£å¸¸åœºæ™¯ã€è¾¹ç•Œæ¡ä»¶å’Œå¼‚å¸¸æƒ…å†µ
- ä½¿ç”¨æ¸…æ™°çš„è¡¨æ ¼æ ¼å¼ç»„ç»‡æµ‹è¯•ç”¨ä¾‹

## æµ‹è¯•ç”¨ä¾‹æ ¼å¼
æ¯ä¸ªæµ‹è¯•ç”¨ä¾‹åº”åŒ…å«ï¼š
- ç”¨ä¾‹ç¼–å·
- æµ‹è¯•åœºæ™¯æè¿°
- å‰ææ¡ä»¶
- è¾“å…¥æ•°æ®
- æ“ä½œæ­¥éª¤
- é¢„æœŸç»“æœ

## è¦†ç›–èŒƒå›´
- âœ… æ­£å¸¸åœºæ™¯ï¼ˆHappy Pathï¼‰
- âœ… è¾¹ç•Œæ¡ä»¶ï¼ˆBoundary Conditionsï¼‰
- âœ… å¼‚å¸¸æƒ…å†µï¼ˆError Handlingï¼‰
- âœ… å®‰å…¨æ€§æµ‹è¯•ï¼ˆSecurityï¼‰
- âœ… æ€§èƒ½æµ‹è¯•ï¼ˆPerformanceï¼‰
- âœ… å…¼å®¹æ€§æµ‹è¯•ï¼ˆCompatibilityï¼‰
- âœ… ç”¨æˆ·ä½“éªŒæµ‹è¯•ï¼ˆUXï¼‰

è¯·ç”Ÿæˆç»“æ„åŒ–ã€æ˜“äºç†è§£å’Œæ‰§è¡Œçš„æµ‹è¯•ç”¨ä¾‹ã€‚
```

**ä¼˜åŠ¿**ï¼š
- âœ… æç¤ºè¯æ›´è¯¦ç»†ã€æ›´ä¸“ä¸š
- âœ… ä¿®æ”¹åªéœ€ç¼–è¾‘æ–‡æœ¬æ–‡ä»¶
- âœ… æ˜“äºç»´æŠ¤å’Œä¼˜åŒ–
- âœ… æ”¯æŒç‰ˆæœ¬æ§åˆ¶
- âœ… ä½¿ç”¨ Markdown æ ¼å¼ï¼Œå¯è¯»æ€§å¼º

---

## ğŸš€ é«˜çº§åŠŸèƒ½

### 1. **è‡ªå®šä¹‰æç¤ºè¯ç›®å½•**

```python
from prompts.prompt_loader import PromptLoader

# ä½¿ç”¨è‡ªå®šä¹‰ç›®å½•
loader = PromptLoader("/path/to/custom/prompts")
system_message = loader.load("custom_prompt")
```

### 2. **ç¦ç”¨ç¼“å­˜ï¼ˆå¼€å‘æ¨¡å¼ï¼‰**

```python
# æ¯æ¬¡éƒ½ä»æ–‡ä»¶è¯»å–ï¼Œæ–¹ä¾¿è°ƒè¯•
system_message = loader.load("test_case_generator", use_cache=False)
```

### 3. **åˆ—å‡ºæ‰€æœ‰å¯ç”¨æç¤ºè¯**

```python
from prompts.prompt_loader import get_prompt_loader

loader = get_prompt_loader()
prompts = loader.list_prompts()
print(f"å¯ç”¨æç¤ºè¯: {prompts}")
# è¾“å‡º: ['assistant', 'test_case_generator', 'test_case_optimizer', 'test_case_reviewer']
```

### 4. **è·å–æç¤ºè¯æ–‡ä»¶è·¯å¾„**

```python
path = loader.get_prompt_path("test_case_generator")
print(f"æç¤ºè¯æ–‡ä»¶è·¯å¾„: {path}")
# è¾“å‡º: /path/to/backend/prompts/test_case_generator.txt
```

---

## ğŸ“š æœ€ä½³å®è·µ

### 1. **ç¼–å†™æç¤ºè¯**

#### âœ… å¥½çš„æç¤ºè¯
```
ä½ æ˜¯ä¸€ä¸ª[è§’è‰²åç§°]ï¼Œè´Ÿè´£[ä¸»è¦èŒè´£]ã€‚

## èŒè´£
- èŒè´£ 1
- èŒè´£ 2

## è¾“å‡ºæ ¼å¼
- æ ¼å¼è¦æ±‚ 1
- æ ¼å¼è¦æ±‚ 2

## æ³¨æ„äº‹é¡¹
- æ³¨æ„äº‹é¡¹ 1
- æ³¨æ„äº‹é¡¹ 2
```

#### âŒ ä¸å¥½çš„æç¤ºè¯
```
ä½ æ˜¯ä¸€ä¸ªä¸“å®¶ï¼Œè¯·å¸®æˆ‘åšäº‹æƒ…ã€‚
```

### 2. **ä½¿ç”¨ Markdown æ ¼å¼**
- ä½¿ç”¨æ ‡é¢˜ç»„ç»‡å†…å®¹ï¼ˆ`##`ã€`###`ï¼‰
- ä½¿ç”¨åˆ—è¡¨å±•ç¤ºè¦ç‚¹ï¼ˆ`-`ã€`1.`ï¼‰
- ä½¿ç”¨åŠ ç²—å¼ºè°ƒé‡ç‚¹ï¼ˆ`**é‡ç‚¹**`ï¼‰
- ä½¿ç”¨ä»£ç å—å±•ç¤ºç¤ºä¾‹ï¼ˆ` ``` `ï¼‰

### 3. **ç‰ˆæœ¬æ§åˆ¶**

```bash
# æäº¤æç¤ºè¯ä¿®æ”¹
git add backend/prompts/test_case_generator.txt
git commit -m "ä¼˜åŒ–æµ‹è¯•ç”¨ä¾‹ç”Ÿæˆå™¨æç¤ºè¯ï¼šå¢åŠ å®‰å…¨æ€§æµ‹è¯•è¦æ±‚"

# æŸ¥çœ‹ä¿®æ”¹å†å²
git log backend/prompts/test_case_generator.txt

# æ¯”è¾ƒä¸åŒç‰ˆæœ¬
git diff HEAD~1 backend/prompts/test_case_generator.txt
```

### 4. **è¿­ä»£ä¼˜åŒ–**
1. ä»ç®€å•çš„æç¤ºè¯å¼€å§‹
2. æ ¹æ®å®é™…æ•ˆæœé€æ­¥ä¼˜åŒ–
3. è®°å½•æ¯æ¬¡ä¿®æ”¹çš„åŸå› å’Œæ•ˆæœ
4. è¿›è¡Œ A/B æµ‹è¯•å¯¹æ¯”

---

## ğŸ” æ•…éšœæ’æŸ¥

### é—®é¢˜ 1: æç¤ºè¯æ–‡ä»¶ä¸å­˜åœ¨

```
FileNotFoundError: æç¤ºè¯æ–‡ä»¶ä¸å­˜åœ¨: /path/to/prompts/xxx.txt
```

**è§£å†³æ–¹æ¡ˆ**ï¼š
- æ£€æŸ¥æ–‡ä»¶åæ˜¯å¦æ­£ç¡®
- ç¡®è®¤æ–‡ä»¶æ˜¯å¦å­˜åœ¨äº `backend/prompts/` ç›®å½•
- æ£€æŸ¥æ–‡ä»¶æ‰©å±•åæ˜¯å¦ä¸º `.txt`

### é—®é¢˜ 2: å¯¼å…¥é”™è¯¯

```
ModuleNotFoundError: No module named 'prompts'
```

**è§£å†³æ–¹æ¡ˆ**ï¼š
- ç¡®è®¤ `backend/prompts/` ç›®å½•å­˜åœ¨
- ç¡®è®¤ `prompt_loader.py` æ–‡ä»¶å­˜åœ¨
- æ£€æŸ¥ Python è·¯å¾„é…ç½®

### é—®é¢˜ 3: ç¼“å­˜æœªæ›´æ–°

**è§£å†³æ–¹æ¡ˆ**ï¼š
```python
# æ¸…é™¤ç¼“å­˜å¹¶é‡æ–°åŠ è½½
from prompts.prompt_loader import get_prompt_loader

loader = get_prompt_loader()
loader.clear_cache()
system_message = loader.load("test_case_generator")
```

---

## ğŸ“ˆ æ€§èƒ½ä¼˜åŒ–

### 1. **ç¼“å­˜æœºåˆ¶**
- é»˜è®¤å¯ç”¨ç¼“å­˜ï¼Œé¿å…é‡å¤è¯»å–æ–‡ä»¶
- é¦–æ¬¡åŠ è½½åï¼Œåç»­è°ƒç”¨ç›´æ¥ä»å†…å­˜è¯»å–
- æ˜¾è‘—æé«˜æ€§èƒ½

### 2. **æ‡’åŠ è½½**
- åªåœ¨éœ€è¦æ—¶åŠ è½½æç¤ºè¯
- ä¸ä¼šä¸€æ¬¡æ€§åŠ è½½æ‰€æœ‰æç¤ºè¯
- å‡å°‘å†…å­˜å ç”¨

### 3. **å•ä¾‹æ¨¡å¼**
- å…¨å±€å…±äº«ä¸€ä¸ª `PromptLoader` å®ä¾‹
- é¿å…é‡å¤åˆ›å»ºåŠ è½½å™¨
- å…±äº«ç¼“å­˜ï¼Œæé«˜æ•ˆç‡

---

## ğŸ¨ æœªæ¥æ‰©å±•

### 1. **å¤šè¯­è¨€æ”¯æŒ**
```
prompts/
â”œâ”€â”€ zh/
â”‚   â”œâ”€â”€ assistant.txt
â”‚   â””â”€â”€ test_case_generator.txt
â””â”€â”€ en/
    â”œâ”€â”€ assistant.txt
    â””â”€â”€ test_case_generator.txt
```

### 2. **ç¯å¢ƒå˜é‡é…ç½®**
```python
# æ ¹æ®ç¯å¢ƒåŠ è½½ä¸åŒçš„æç¤ºè¯
loader = PromptLoader(os.getenv("PROMPTS_DIR", "backend/prompts"))
```

### 3. **æç¤ºè¯æ¨¡æ¿**
```python
# æ”¯æŒå˜é‡æ›¿æ¢
template = load_prompt("template")
prompt = template.format(role="æµ‹è¯•ä¸“å®¶", task="ç”Ÿæˆæµ‹è¯•ç”¨ä¾‹")
```

### 4. **æç¤ºè¯éªŒè¯**
```python
# éªŒè¯æç¤ºè¯æ ¼å¼å’Œå†…å®¹
validator = PromptValidator()
validator.validate("test_case_generator")
```

---

## ğŸ“– ç›¸å…³æ–‡æ¡£

- **ä½¿ç”¨æ–‡æ¡£**: `backend/prompts/README.md`
- **æç¤ºè¯æ–‡ä»¶**: `backend/prompts/*.txt`
- **åŠ è½½å™¨ä»£ç **: `backend/prompts/prompt_loader.py`
- **æœåŠ¡ä»£ç **: `backend/services/ai_service.py`

---

**æç¤ºè¯ç®¡ç†ç³»ç»Ÿå®ç°å®Œæˆï¼ç°åœ¨å¯ä»¥è½»æ¾ç®¡ç†å’Œä¼˜åŒ–æ‰€æœ‰æ™ºèƒ½ä½“çš„æç¤ºè¯äº†ï¼** ğŸ‰ğŸ“âœ¨

**å¿«é€Ÿå¼€å§‹**ï¼š
1. æŸ¥çœ‹ `backend/prompts/README.md` äº†è§£è¯¦ç»†ç”¨æ³•
2. ç¼–è¾‘ `backend/prompts/*.txt` æ–‡ä»¶ä¼˜åŒ–æç¤ºè¯
3. é‡å¯æœåŠ¡æŸ¥çœ‹æ•ˆæœ
4. ä½¿ç”¨ Git ç®¡ç†æç¤ºè¯ç‰ˆæœ¬

