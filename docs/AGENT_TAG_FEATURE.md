# æ™ºèƒ½ä½“æ ‡ç­¾é€‰æ‹©åŠŸèƒ½

## ğŸ¯ åŠŸèƒ½æ¦‚è¿°

åœ¨åé¦ˆå¯¹è¯æ¡†ä¸­æ·»åŠ äº†å¯ç‚¹å‡»çš„æ™ºèƒ½ä½“æ ‡ç­¾ï¼Œç”¨æˆ·å¯ä»¥é€šè¿‡ç‚¹å‡»æ ‡ç­¾å¿«é€Ÿé€‰æ‹©è¦å›å¤çš„æ™ºèƒ½ä½“ï¼Œæå‡äº¤äº’ä½“éªŒã€‚

## âœ¨ æ–°åŠŸèƒ½

### 1. å¯ç‚¹å‡»çš„æ™ºèƒ½ä½“æ ‡ç­¾

åœ¨åé¦ˆå¯¹è¯æ¡†ä¸­ï¼Œæ˜¾ç¤ºæ‰€æœ‰å¯ç”¨çš„æ™ºèƒ½ä½“ä½œä¸ºå¯ç‚¹å‡»çš„æ ‡ç­¾ï¼š

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ ğŸ’¬ æµ‹è¯•ç”¨ä¾‹è¯„å®¡å‘˜ å·²å®Œæˆï¼Œè¯·æä¾›åé¦ˆ      â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚ â€¢ ç›´æ¥ç‚¹å‡»"åŒæ„"ï¼ŒOptimizer å°†ç»™å‡ºæœ€ç»ˆæ–¹æ¡ˆ â”‚
â”‚ â€¢ ç‚¹å‡»ä¸‹æ–¹æ™ºèƒ½ä½“æ ‡ç­¾ï¼ŒæŒ‡å®šç‰¹å®šæ™ºèƒ½ä½“å›ç­”   â”‚
â”‚ â€¢ ç‚¹å‡»"All"ï¼Œé‡æ–°è¿è¡Œ Generator â†’ Reviewer â”‚
â”‚                                         â”‚
â”‚ é€‰æ‹©æ™ºèƒ½ä½“ï¼š                             â”‚
â”‚ [ğŸ”„ All] [ğŸ¯ Generator] [ğŸ” Reviewer]   â”‚
â”‚ [âš¡ Optimizer]                          â”‚
â”‚                                         â”‚
â”‚                        [âœ… åŒæ„]         â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

### 2. All æ ‡ç­¾

- **åŠŸèƒ½**ï¼šé‡æ–°è¿è¡Œ Generator â†’ Reviewer æµç¨‹
- **å›¾æ ‡**ï¼šğŸ”„
- **é¢œè‰²**ï¼šç»¿è‰²æ¸å˜
- **ç”¨é€”**ï¼šå½“ç”¨æˆ·æƒ³è¦å®Œæ•´é‡æ–°ç”Ÿæˆå’Œè¯„å®¡æµ‹è¯•ç”¨ä¾‹æ—¶ä½¿ç”¨

### 3. æ™ºèƒ½ä½“æ ‡ç­¾

æ¯ä¸ªæ™ºèƒ½ä½“éƒ½æœ‰ç‹¬ç‰¹çš„å›¾æ ‡ï¼š
- **Generator** ğŸ¯ - ç”Ÿæˆå™¨
- **Reviewer** ğŸ” - è¯„å®¡å‘˜
- **Optimizer** âš¡ - ä¼˜åŒ–å™¨

### 4. æ¸…é™¤æŒ‰é’®

å½“ç”¨æˆ·ç‚¹å‡»äº†æŸä¸ªæ ‡ç­¾åï¼Œè¾“å…¥æ¡†ä¸­ä¼šè‡ªåŠ¨æ·»åŠ  `@æ™ºèƒ½ä½“åç§°`ï¼Œæ­¤æ—¶ä¼šæ˜¾ç¤º"æ¸…é™¤"æŒ‰é’®ï¼š

```
[ğŸ”„ All] [ğŸ¯ Generator] [ğŸ” Reviewer] [âš¡ Optimizer] [âœ–ï¸ æ¸…é™¤]
```

ç‚¹å‡»"æ¸…é™¤"æŒ‰é’®å¯ä»¥ç§»é™¤è¾“å…¥æ¡†ä¸­çš„ @ æåŠã€‚

## ğŸ¨ äº¤äº’é€»è¾‘

### ç‚¹å‡»æ™ºèƒ½ä½“æ ‡ç­¾

1. **é¦–æ¬¡ç‚¹å‡»**ï¼š
   ```
   è¾“å…¥æ¡†ï¼šç©º
   ç‚¹å‡» [ğŸ¯ Generator]
   è¾“å…¥æ¡†ï¼š@TestCase_Generator 
   ```

2. **å·²æœ‰å†…å®¹**ï¼š
   ```
   è¾“å…¥æ¡†ï¼šè¯·æ·»åŠ è¾¹ç•Œæµ‹è¯•
   ç‚¹å‡» [ğŸ¯ Generator]
   è¾“å…¥æ¡†ï¼š@TestCase_Generator è¯·æ·»åŠ è¾¹ç•Œæµ‹è¯•
   ```

3. **æ›¿æ¢å·²æœ‰æ ‡ç­¾**ï¼š
   ```
   è¾“å…¥æ¡†ï¼š@TestCase_Reviewer è¯·ä¼˜åŒ–
   ç‚¹å‡» [ğŸ¯ Generator]
   è¾“å…¥æ¡†ï¼š@TestCase_Generator è¯·ä¼˜åŒ–
   ```

### ç‚¹å‡» All æ ‡ç­¾

```
è¾“å…¥æ¡†ï¼šç©º
ç‚¹å‡» [ğŸ”„ All]
è¾“å…¥æ¡†ï¼š@all 
```

### ç‚¹å‡»æ¸…é™¤æŒ‰é’®

```
è¾“å…¥æ¡†ï¼š@TestCase_Generator è¯·æ·»åŠ æµ‹è¯•
ç‚¹å‡» [âœ–ï¸ æ¸…é™¤]
è¾“å…¥æ¡†ï¼šè¯·æ·»åŠ æµ‹è¯•
```

## ğŸ”§ æŠ€æœ¯å®ç°

### å‰ç«¯å®ç°

#### 1. æ™ºèƒ½ä½“æ ‡ç­¾ç‚¹å‡»å¤„ç†

```javascript
const handleAgentTagClick = (agentName) => {
  const currentInput = inputValue.trim();
  const hasAtMention = currentInput.match(/@(TestCase_\w+|all)/i);
  
  if (hasAtMention) {
    // æ›¿æ¢å·²æœ‰çš„ @ æåŠ
    const newInput = currentInput.replace(/@(TestCase_\w+|all)/i, `@${agentName}`);
    setInputValue(newInput);
  } else {
    // æ·»åŠ åˆ°å¼€å¤´
    setInputValue(`@${agentName} ${currentInput}`);
  }
  
  message.success(`å·²é€‰æ‹© @${agentName}`);
};
```

#### 2. æ¸…é™¤ @ æåŠ

```javascript
const handleClearMention = () => {
  const currentInput = inputValue.trim();
  const newInput = currentInput.replace(/@(TestCase_\w+|all)\s*/i, '');
  setInputValue(newInput);
  message.success('å·²æ¸…é™¤æ™ºèƒ½ä½“é€‰æ‹©');
};
```

#### 3. UI æ¸²æŸ“

```jsx
<div className="agent-tags-container">
  <div className="agent-tags-label">é€‰æ‹©æ™ºèƒ½ä½“ï¼š</div>
  <div className="agent-tags">
    {/* All æ ‡ç­¾ */}
    <motion.button
      className="agent-tag agent-tag-all"
      onClick={() => handleAgentTagClick('all')}
    >
      <span className="agent-tag-icon">ğŸ”„</span>
      <span className="agent-tag-name">All</span>
    </motion.button>
    
    {/* æ™ºèƒ½ä½“æ ‡ç­¾ */}
    {availableAgents.map(agentName => (
      <motion.button
        className="agent-tag"
        onClick={() => handleAgentTagClick(agentName)}
      >
        <span className="agent-tag-icon">ğŸ¯</span>
        <span className="agent-tag-name">
          {agentName.replace('TestCase_', '')}
        </span>
      </motion.button>
    ))}
    
    {/* æ¸…é™¤æŒ‰é’® */}
    {inputValue.match(/@(TestCase_\w+|all)/i) && (
      <motion.button
        className="agent-tag agent-tag-clear"
        onClick={handleClearMention}
      >
        <span className="agent-tag-icon">âœ–ï¸</span>
        <span className="agent-tag-name">æ¸…é™¤</span>
      </motion.button>
    )}
  </div>
</div>
```

### åç«¯å®ç°

#### 1. è§£æ @all

```python
def _parse_target_agent(message: str) -> Optional[str]:
    # å…ˆåŒ¹é… @allï¼ˆä¸åŒºåˆ†å¤§å°å†™ï¼‰
    if re.search(r'@all\b', message, re.IGNORECASE):
        print(f"ğŸ”„ æ£€æµ‹åˆ° @allï¼Œå°†é‡æ–°è¿è¡Œ Generator â†’ Reviewer æµç¨‹")
        return "all"
    
    # åŒ¹é… @æ™ºèƒ½ä½“åç§°
    match = re.search(r'@(TestCase_\w+)', message)
    if match:
        agent_name = match.group(1)
        print(f"ğŸ¯ æ£€æµ‹åˆ°ç›®æ ‡æ™ºèƒ½ä½“: {agent_name}")
        return agent_name
    
    return None
```

#### 2. å¤„ç† @all

```python
if target_agent == "all":
    # ç”¨æˆ·é€‰æ‹© @allï¼Œé‡æ–°è¿è¡Œ Generator â†’ Reviewer æµç¨‹
    feedback_message = f"å¯¹è¯å†å²ï¼š\n{history_text}\n\nç”¨æˆ·åé¦ˆï¼ˆ@allï¼‰: {request.message}"
    
    # åˆ›å»ºæ–°çš„å›¢é˜ŸæœåŠ¡å®ä¾‹ï¼ˆGenerator â†’ Reviewerï¼‰
    team_service = TestCasesTeamAIService(settings)
    await team_service.initialize()  # é»˜è®¤åŒ…å« Generator å’Œ Reviewer
    
    print(f"ğŸ”„ ç»§ç»­å¯¹è¯ {conversation_id}ï¼Œ@all é‡æ–°è¿è¡Œ Generator â†’ Reviewer æµç¨‹")
elif target_agent:
    # ç”¨æˆ·æŒ‡å®šäº†ç‰¹å®šæ™ºèƒ½ä½“
    # ...
else:
    # ç”¨æˆ·æœªæŒ‡å®šæ™ºèƒ½ä½“
    # ...
```

## ğŸ¨ æ ·å¼è®¾è®¡

### æ™ºèƒ½ä½“æ ‡ç­¾æ ·å¼

```css
.agent-tag {
  display: inline-flex;
  align-items: center;
  gap: 8px;
  padding: 10px 16px;
  background: linear-gradient(135deg, rgba(102, 126, 234, 0.2) 0%, rgba(118, 75, 162, 0.2) 100%);
  border: 1px solid rgba(102, 126, 234, 0.3);
  border-radius: 8px;
  color: rgba(255, 255, 255, 0.9);
  font-size: 14px;
  font-weight: 500;
  cursor: pointer;
  transition: all 0.3s ease;
  animation: fadeInUp 0.3s ease;
}

.agent-tag:hover {
  background: linear-gradient(135deg, rgba(102, 126, 234, 0.3) 0%, rgba(118, 75, 162, 0.3) 100%);
  border-color: rgba(102, 126, 234, 0.5);
  transform: translateY(-2px);
  box-shadow: 0 4px 12px rgba(102, 126, 234, 0.3);
}
```

### All æ ‡ç­¾ç‰¹æ®Šæ ·å¼

```css
.agent-tag-all {
  background: linear-gradient(135deg, rgba(52, 211, 153, 0.2) 0%, rgba(16, 185, 129, 0.2) 100%);
  border-color: rgba(52, 211, 153, 0.3);
}

.agent-tag-all:hover {
  background: linear-gradient(135deg, rgba(52, 211, 153, 0.3) 0%, rgba(16, 185, 129, 0.3) 100%);
  border-color: rgba(52, 211, 153, 0.5);
  box-shadow: 0 4px 12px rgba(52, 211, 153, 0.3);
}
```

### æ¸…é™¤æŒ‰é’®ç‰¹æ®Šæ ·å¼

```css
.agent-tag-clear {
  background: linear-gradient(135deg, rgba(239, 68, 68, 0.2) 0%, rgba(220, 38, 38, 0.2) 100%);
  border-color: rgba(239, 68, 68, 0.3);
}

.agent-tag-clear:hover {
  background: linear-gradient(135deg, rgba(239, 68, 68, 0.3) 0%, rgba(220, 38, 38, 0.3) 100%);
  border-color: rgba(239, 68, 68, 0.5);
  box-shadow: 0 4px 12px rgba(239, 68, 68, 0.3);
}
```

## ğŸ“ ä½¿ç”¨ç¤ºä¾‹

### ç¤ºä¾‹ 1ï¼šä½¿ç”¨ All é‡æ–°ç”Ÿæˆ

```
1. ç”¨æˆ·å‘é€ï¼š"ç”Ÿæˆç™»å½•åŠŸèƒ½æµ‹è¯•ç”¨ä¾‹"
2. Generator â†’ Reviewer å®Œæˆ
3. ç”¨æˆ·ç‚¹å‡» [ğŸ”„ All]
4. è¾“å…¥æ¡†æ˜¾ç¤ºï¼š@all 
5. ç”¨æˆ·è¾“å…¥ï¼š@all è¯·æ·»åŠ å®‰å…¨æµ‹è¯•
6. å‘é€åï¼Œé‡æ–°è¿è¡Œ Generator â†’ Reviewer
```

### ç¤ºä¾‹ 2ï¼šæŒ‡å®š Generator

```
1. ç”¨æˆ·å‘é€ï¼š"ç”Ÿæˆç™»å½•åŠŸèƒ½æµ‹è¯•ç”¨ä¾‹"
2. Generator â†’ Reviewer å®Œæˆ
3. ç”¨æˆ·ç‚¹å‡» [ğŸ¯ Generator]
4. è¾“å…¥æ¡†æ˜¾ç¤ºï¼š@TestCase_Generator 
5. ç”¨æˆ·è¾“å…¥ï¼š@TestCase_Generator è¯·æ·»åŠ è¾¹ç•Œæµ‹è¯•
6. å‘é€åï¼Œåªæœ‰ Generator å›ç­”
```

### ç¤ºä¾‹ 3ï¼šåˆ‡æ¢æ™ºèƒ½ä½“

```
1. ç”¨æˆ·ç‚¹å‡» [ğŸ¯ Generator]
2. è¾“å…¥æ¡†æ˜¾ç¤ºï¼š@TestCase_Generator 
3. ç”¨æˆ·æ”¹å˜ä¸»æ„ï¼Œç‚¹å‡» [ğŸ” Reviewer]
4. è¾“å…¥æ¡†æ˜¾ç¤ºï¼š@TestCase_Reviewer ï¼ˆè‡ªåŠ¨æ›¿æ¢ï¼‰
5. ç”¨æˆ·è¾“å…¥ï¼š@TestCase_Reviewer è¯·è¯„å®¡å®‰å…¨æ€§
6. å‘é€åï¼Œåªæœ‰ Reviewer å›ç­”
```

### ç¤ºä¾‹ 4ï¼šæ¸…é™¤é€‰æ‹©

```
1. ç”¨æˆ·ç‚¹å‡» [ğŸ¯ Generator]
2. è¾“å…¥æ¡†æ˜¾ç¤ºï¼š@TestCase_Generator 
3. ç”¨æˆ·ç‚¹å‡» [âœ–ï¸ æ¸…é™¤]
4. è¾“å…¥æ¡†æ˜¾ç¤ºï¼šï¼ˆç©ºï¼‰
5. ç”¨æˆ·è¾“å…¥ï¼šè¯·ä¼˜åŒ–æµ‹è¯•ç”¨ä¾‹
6. å‘é€åï¼Œé‡æ–°è¿è¡Œ Generator â†’ Reviewerï¼ˆé»˜è®¤è¡Œä¸ºï¼‰
```

## ğŸ‰ ä¼˜åŠ¿

âœ… **ç›´è§‚æ˜“ç”¨** - å¯è§†åŒ–çš„æ ‡ç­¾é€‰æ‹©ï¼Œæ— éœ€æ‰‹åŠ¨è¾“å…¥  
âœ… **å¿«é€Ÿåˆ‡æ¢** - ç‚¹å‡»å³å¯åˆ‡æ¢æ™ºèƒ½ä½“ï¼Œè‡ªåŠ¨æ›¿æ¢  
âœ… **é˜²æ­¢é”™è¯¯** - é¿å…æ‰‹åŠ¨è¾“å…¥æ—¶çš„æ‹¼å†™é”™è¯¯  
âœ… **è§†è§‰åé¦ˆ** - æ‚¬åœå’Œç‚¹å‡»åŠ¨ç”»ï¼Œæ¸…æ™°çš„äº¤äº’åé¦ˆ  
âœ… **çµæ´»æ§åˆ¶** - æ”¯æŒ Allã€ç‰¹å®šæ™ºèƒ½ä½“ã€æ¸…é™¤ç­‰å¤šç§æ“ä½œ  
âœ… **å“åº”å¼è®¾è®¡** - æ”¯æŒæ·±è‰²/æµ…è‰²ä¸»é¢˜ï¼Œé€‚é…ä¸åŒå±å¹•

## ğŸ“ ä¿®æ”¹çš„æ–‡ä»¶

1. **`frontend/src/App.jsx`**
   - æ·»åŠ  `handleAgentTagClick()` å‡½æ•°
   - æ·»åŠ  `handleClearMention()` å‡½æ•°
   - ä¿®æ”¹åé¦ˆå¯¹è¯æ¡† UIï¼Œæ·»åŠ æ™ºèƒ½ä½“æ ‡ç­¾

2. **`frontend/src/App.css`**
   - æ·»åŠ  `.agent-tags-container` æ ·å¼
   - æ·»åŠ  `.agent-tag` æ ·å¼
   - æ·»åŠ  `.agent-tag-all` ç‰¹æ®Šæ ·å¼
   - æ·»åŠ  `.agent-tag-clear` ç‰¹æ®Šæ ·å¼
   - æ·»åŠ  `fadeInUp` åŠ¨ç”»

3. **`backend/api/routes.py`**
   - ä¿®æ”¹ `_parse_target_agent()` å‡½æ•°ï¼Œæ”¯æŒ `@all`
   - ä¿®æ”¹åé¦ˆå¤„ç†é€»è¾‘ï¼ŒåŒºåˆ† `@all`ã€ç‰¹å®šæ™ºèƒ½ä½“ã€æ— æŒ‡å®šä¸‰ç§æƒ…å†µ

## ğŸ§ª æµ‹è¯•æ–¹æ³•

1. å‘é€æµ‹è¯•éœ€æ±‚
2. ç­‰å¾… Generator â†’ Reviewer å®Œæˆ
3. æŸ¥çœ‹åé¦ˆå¯¹è¯æ¡†ä¸­çš„æ™ºèƒ½ä½“æ ‡ç­¾
4. ç‚¹å‡»ä¸åŒçš„æ ‡ç­¾ï¼Œè§‚å¯Ÿè¾“å…¥æ¡†å˜åŒ–
5. ç‚¹å‡»"æ¸…é™¤"æŒ‰é’®ï¼ŒéªŒè¯æ¸…é™¤åŠŸèƒ½
6. å‘é€åé¦ˆï¼ŒéªŒè¯åç«¯æ­£ç¡®å¤„ç†

ç°åœ¨å¯ä»¥æµ‹è¯•æ–°åŠŸèƒ½äº†ï¼ğŸ‰

